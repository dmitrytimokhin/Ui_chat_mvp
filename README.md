# üß† –õ–æ–∫–∞–ª—å–Ω—ã–π LLM-—á–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Ollama –∏ Qwen

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–ª–æ–∫–∞–ª—å–Ω—ã–π —á–∞—Ç —Å —è–∑—ã–∫–æ–≤—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏**, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ (–±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –æ–±–ª–∞—á–Ω—ã–º API). –û–Ω –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–≤–∞ –º–æ—â–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞:
- **Ollama** ‚Äî –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ª—ë–≥–∫–∏—Ö –º–æ–¥–µ–ª–µ–π (`phi3`) —á–µ—Ä–µ–∑ HTTP API.
- **Transformers (Hugging Face)** ‚Äî –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ **Qwen3-1.7B** –ø—Ä—è–º–æ –≤ –ø–∞–º—è—Ç–∏.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
```
Streamlit (UI) ‚Üí FastAPI (–±—ç–∫–µ–Ω–¥) ‚Üí LLM (Ollama –∏–ª–∏ Qwen)
```
---

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- `ollama` (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ)
# üß† Ui_chat_mvp ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π LLM‚Äë—á–∞—Ç (Ollama + Qwen)

–ö–æ—Ä–æ—Ç–∫–æ: –ª—ë–≥–∫–∏–π –ª–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å LLM-–º–æ–¥–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ Streamlit + FastAPI.
–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –æ–±–ª–∞—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
- `Streamlit` ‚Äî UI (`chat_ui.py`).
- `FastAPI` ‚Äî HTTP API (`fastapi_llm/main.py`, endpoint: `/chat`).
- LLM-–∞–¥–∞–ø—Ç–µ—Ä—ã ‚Äî `fastapi_llm/llm_ollama.py` (Ollama) –∏ `fastapi_llm/llm_qwen.py` (Hugging Face/transformers).

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ:** –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã (—Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è, –æ–±—Ä–µ–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ) –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ `fastapi_llm/utils.py`. –ê–¥–∞–ø—Ç–µ—Ä—ã –±—Ä–æ—Å–∞—é—Ç –µ–¥–∏–Ω—ã–π —Ç–∏–ø –æ—à–∏–±–æ–∫ `EngineError`, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ `main.py`.

**–í–∞–∂–Ω–æ –¥–ª—è `qwen_transformers`:** –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è Qwen –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `/no_think` —á—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–µ—Ç–∫–∏ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è.

---

**–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)**

1) –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

2) (–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Ollama) –∑–∞–≥—Ä—É–∑–∏—Ç–µ –º–æ–¥–µ–ª—å `phi3` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ Ollama:

```bash
ollama pull phi3
ollama serve
```

3) –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥ –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (–≤ –¥–≤—É—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö):

```bash
# backend
uvicorn fastapi_llm.main:app --host 0.0.0.0 --port 8000 --reload

# frontend
streamlit run chat_ui.py --server.port=8501
```

API: http://localhost:8000
UI:  http://localhost:8501

---

**Docker (dev)**

–ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç `Dockerfile.app` –∏ `docker-compose.yaml` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞. –¢–µ–∫—É—â–∏–π Dockerfile –∑–∞–ø—É—Å–∫–∞–µ—Ç backend –∏ Streamlit –≤ –æ–¥–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (—É–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è production).

–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose:

```bash
docker-compose up --build
```

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è production: —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã (–æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è API –∏ UI), –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä (gunicorn/uvicorn workers) –∏ –≤–Ω–µ—à–Ω–∏–µ volume/env-—Ñ–∞–π–ª—ã.

---

**–ú–æ–¥–µ–ª—å–Ω—ã–µ –∞–ª–∏–∞—Å—ã**
- `phi3_ollama` ‚Äî –∑–∞–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Ollama (env: `OLLAMA_URL` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
- `qwen_transformers` ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ `transformers`. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Qwen –≤ —Å–∏—Å—Ç–µ–º–Ω—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `/no_think`.

---

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º**
- –ö–æ–Ω—Ç–µ–∫—Å—Ç (–∏—Å—Ç–æ—Ä–∏—è + prompt) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –ø–æ —Ç–æ–∫–µ–Ω–∞–º.
- –¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è –∏ –ª–æ–≥–∏–∫–∞ —É—Å–µ—á–µ–Ω–∏–π –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `fastapi_llm/utils.py`.

---

**–ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ –≤ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ**
- `fastapi_llm/utils.py`: –µ–¥–∏–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤, –æ–±—Ä–µ–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏, —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
- –ï–¥–∏–Ω—ã–π —Ç–∏–ø –æ—à–∏–±–æ–∫ `EngineError` –¥–ª—è –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç `main.py` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑–¥–µ–ª—è—Ç—å –æ—à–∏–±–∫–∏ –¥–≤–∏–∂–∫–∞ –∏ –æ—à–∏–±–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- `llm_qwen.py`: —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞—ë—Ç `input_ids` –∏ `attention_mask` –≤ `model.generate(...)` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `GenerationConfig` ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è transformers —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã.

---

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ / next steps**
- –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è `utils.truncate_history`.
- –î–æ–±–∞–≤–∏—Ç—å health/readiness endpoint –∏ –º–µ—Ç—Ä–∏–∫–∏ (Prometheus) –≤ `fastapi_llm/main.py`.
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI (lint, tests, build image).
- –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å Dockerfile: —Ä–∞–∑–¥–µ–ª–∏—Ç—å UI/API, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å production-ready process manager.

---

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–æ—Å–Ω–æ–≤–Ω–æ–µ)**

- `chat_ui.py` ‚Äî Streamlit UI.
- `fastapi_llm/main.py` ‚Äî FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
- `fastapi_llm/models.py` ‚Äî Pydantic-–º–æ–¥–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–∞/–æ—Ç–≤–µ—Ç–∞.
- `fastapi_llm/llm_ollama.py` ‚Äî –∞–¥–∞–ø—Ç–µ—Ä Ollama.
- `fastapi_llm/llm_qwen.py` ‚Äî –∞–¥–∞–ø—Ç–µ—Ä Qwen (transformers).
- `fastapi_llm/utils.py` ‚Äî –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã (—Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è / truncate / –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ).

---

–ê–≤—Ç–æ—Ä: Dmitry ‚Äî —É–ª—É—á—à–µ–Ω–∏—è: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —É—Ç–∏–ª–∏—Ç, —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è Qwen.
