# üß† –õ–æ–∫–∞–ª—å–Ω—ã–π Multi-User LLM-—á–∞—Ç —Å Ollama –∏ Qwen3

**Ui_chat_mvp** ‚Äî –ª—ë–≥–∫–æ–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ —á–∞—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∏–∞–ª–æ–≥–∞–º–∏ –∏ –¥–≤—É–º—è –¥–≤–∏–∂–∫–∞–º–∏ LLM: **Ollama** –∏ **–ª–æ–∫–∞–ª—å–Ω–∞—è Qwen3 —á–µ—Ä–µ–∑ Transformers**.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:  
**Streamlit (UI)** ‚Üí **FastAPI (Backend)** ‚Üí **Ollama / Qwen3 (Local LLMs)**

---

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîê **–õ–æ–∫–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è + –≤—Ö–æ–¥ (–¥–æ 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- üß± **–ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∏–∞–ª–æ–≥–∏
- üí¨ **–ú–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–∏–∞–ª–æ–≥–æ–≤**: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ
- ü§ñ **–î–≤–∞ –¥–≤–∏–∂–∫–∞ LLM**:
  - **Ollama** (`phi3`) ‚Äî –±—ã—Å—Ç—Ä–æ, —á–µ—Ä–µ–∑ API
  - **Qwen3-1.7B** ‚Äî –º–æ—â–Ω–æ, –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (CPU/MPS)
- üìÅ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫**: –≤—Å–µ –¥–∏–∞–ª–æ–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `data/conversations/`
- ‚ôªÔ∏è **–û—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ `gc.collect()` –∏ `torch.mps.empty_cache()`
- üéõÔ∏è **–ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –º–∞–∫—Å. —Ç–æ–∫–µ–Ω—ã ‚Äî **–Ω–∞ –ª–µ—Ç—É**
- üö´ **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π UX**: –Ω–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–∏ —Ç—Ä–µ–±—É—é—Ç —è–≤–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
project/
‚îú‚îÄ‚îÄ app/                          # FastAPI backend
‚îÇ   ‚îú‚îÄ‚îÄ main.py                   # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                   # –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ storage.py                # —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
‚îú‚îÄ‚îÄ ollama_client/                # –∞–¥–∞–ø—Ç–µ—Ä Ollama
‚îÇ   ‚îú‚îÄ‚îÄ client/
‚îÇ   ‚îî‚îÄ‚îÄ endpoint/
‚îú‚îÄ‚îÄ transformers_client/          # –∞–¥–∞–ø—Ç–µ—Ä Qwen3
‚îÇ   ‚îú‚îÄ‚îÄ client/
‚îÇ   ‚îî‚îÄ‚îÄ endpoint/
‚îú‚îÄ‚îÄ chat_ui.py                    # Streamlit UI
‚îú‚îÄ‚îÄ data/                         # –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ conversations/            # {username}.json
‚îú‚îÄ‚îÄ Dockerfile.app
‚îú‚îÄ‚îÄ docker-compose.yaml
‚îî‚îÄ‚îÄ requirements.txt
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–æ)

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
python -m venv .venv
source .venv/bin/activate  # Linux/macOS
# –∏–ª–∏ .venv\Scripts\activate  # Windows
pip install -r requirements.txt
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Ollama (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ)

```bash
ollama pull phi3
# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Ollama –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–æ (–∏–∫–æ–Ω–∫–∞ –≤ –º–µ–Ω—é bar –Ω–∞ macOS)
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

```bash
streamlit run chat_ui.py --server.port=8501
```

> **API**: http://localhost:8000  
> **UI**: http://localhost:8501

---

## üê≥ Docker (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```bash
docker-compose up --build
```

> ‚ö†Ô∏è –í production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã: –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è API –∏ UI.

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: –¥–æ **10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è (SHA256 + —Å–æ–ª—å)
- –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `data/conversations/{username}.json`
- –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –≤–∏–¥—è—Ç —á—É–∂–∏–µ –¥–∏–∞–ª–æ–≥–∏

---

## üéØ UX-–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ –¥–∏–∞–ª–æ–≥–∞ ‚Äî **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –º–æ–¥–µ–ª–∏** –Ω–∞ ¬´‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å ‚Äî¬ª
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –±–µ–∑ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, —Ç–æ–∫–µ–Ω—ã) –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –¥–∏–∞–ª–æ–≥—É
- –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ ‚Äî –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–¥–∞–∂–µ –≤ –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ)

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–≤ `.env`):

```env
# Ollama
OLLAMA_URL=http://host.docker.internal:11434  # –¥–ª—è Docker
# OLLAMA_URL=http://127.0.0.1:11434           # –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

# Qwen3
# (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ—Ç)
```

---

## üß™ –°–æ–≤–µ—Ç—ã –ø–æ –æ—Ç–ª–∞–¥–∫–µ

- –ï—Å–ª–∏ Ollama –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `ollama list` –∏ –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ï—Å–ª–∏ Qwen3 –¥–æ–ª–≥–æ –≥—Ä—É–∑–∏—Ç—Å—è: —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ (1‚Äì3 –º–∏–Ω—É—Ç—ã –Ω–∞ M1/M2)
- –û—à–∏–±–∫–∏ 404/400: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –º–æ–¥–µ–ª–∏ (`phi3`, –∞ –Ω–µ `phi`)
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `torch.float16` –∏ `low_cpu_mem_usage=True`

---

## üìà –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

- [ ] –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è `truncate_history`
- [ ] Health-check —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JWT –≤–º–µ—Å—Ç–æ cookies
- [ ] CI/CD: linting, —Ç–µ—Å—Ç—ã, —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
- [ ] Production-ready Docker (gunicorn + nginx)

---

## üìù –ê–≤—Ç–æ—Ä

Dmitry ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, multi-user –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Qwen3, UX-—É–ª—É—á—à–µ–Ω–∏—è.

---

> üí° **–ö–æ—Ä–æ—Ç–∫–æ**: –ø—Ä–æ–µ–∫—Ç ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π, multi-user LLM-—á–∞—Ç —Å –∏–∑–æ–ª—è—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö, –¥–≤—É–º—è –¥–≤–∏–∂–∫–∞–º–∏ –∏ —É–¥–æ–±–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è —É –≤–∞—Å.
